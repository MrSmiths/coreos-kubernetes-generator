---
storage:
  files:
    - filesystem: "root"
      path:       "/etc/metadata/coreos"
      mode:       0644
      contents:
        inline: |
          COREOS_VAGRANT_VIRTUALBOX_PRIVATE_IPV4=10.0.2.12
          COREOS_VAGRANT_VIRTUALBOX_HOSTNAME=coreos2
    - filesystem: "root"
      path:       "/etc/hostname"
      mode:       0644
      contents:
        inline: coreos2
    - filesystem: "root"
      path:       "/etc/hosts"
      mode:       0644
      contents:
        inline: |
          127.0.0.1	localhost
          ::1		localhost
          10.0.2.11 coreos1 coreos1.example.com
          10.0.2.12 coreos2 coreos2.example.com
          10.0.2.13 coreos3 coreos3.example.com
    - path: /etc/docker/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDfzCCAmegAwIBAgIJAMccpPqk5dkHMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBdMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMQ0wCwYDVQQDDARFdGNkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
          CgKCAQEAsumylGcdl3DlAzCyqRz3+Sy/8H3mU+MfogEAr+ymNwq4c3eXpJbfhl7B
          a54Ji6drS69U4y4Zo3drE+5DjKE+OkMEgspYOo/IsPmCG2T3kH7AJPdgAIFxDiRh
          BDMrodfi9zN6VHTi7Cws2K/21VReYGJceekdoPLt+xxP9R06EWds53ner4pj1viT
          O5xRPZFXTy8iX9AHn5fqNq8nz/zkgmxtdRCbzrfZ+e5phwA7FXFEyMkoDq21ORK2
          TE07d+nIrmZg7oyHhmfXGCoptfRW2oyY+bzmLkZTiMeBr9WFZviCl0aDabQl789Y
          ojEPE460sjEugajGCbO8DJQFnLvZzQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAQYw
          DwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUJg+CfP5qQMBXSh7r4AUKgHrJSjww
          DQYJKoZIhvcNAQELBQADggEBADfNiixNNlpKYIlCAYmSvFXxUSEUXghhTp/WNDGI
          blahg+Mi0IOe7ZbvAJ3G0w10FchSUlB6DBTD0MH9iqUkuX97wLdJETsa5bH7g5XW
          ZDn+SkCwwBcH5UV7Fh7ebYwwWarB8hsXfpDmPbVDeGWrP9o6XXZPCvxSLUvSAcp2
          L0vRGyJGlSWSYBaxVQURRH+7Pl2VEt0udRZ2QVeXoOAagGEkJY4rwAYYVqMM3W7Q
          8nq/l/ai0hCpE4/m5zmcx1HwJbqE7Rg8DU5hwc6SHcZKLuaopsJPpdzKqz/BELKS
          NH8j4RkB7rBmQPm7Zoa98s0I/VfNU1Zd26gmXCSftkKKxLw=
          -----END CERTIFICATE-----

    - path: /etc/docker/server.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIFETCCA/mgAwIBAgIJANiJBN6VG8sKMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBiMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMRIwEAYDVQQDDAlldGNkLW5vZGUwggEiMA0GCSqGSIb3DQEBAQUAA4IB
          DwAwggEKAoIBAQC8dgNyeMbxZ5XUexWzj79ol1+dvy4dtrY0aEGbuzQGwUfsNGdI
          LhC+bAVmsezfKaxhN7/+T+dlUnlE8aWZp6Sv+Jucyvce7Pr1Ib93O+vk681Suvi9
          HbkTDy9xj0G8hDx8fFXefQpo1G5SkSaGD9GXl4iQVc1s+knR3veqWqXNOkaE2/7Z
          erGciB3Yo1WuyUjXD0qbD1N3Np7wGZJsEMJ7FRmTiiZtKKF2HKjHoHyvlt62sXS2
          NA0/FODT1YwLIo6hAWhLq0aR9wsfINSypLg2T5B3hN/pGgR/ZKCpkWgosatvD56w
          JP1xnAacEV7Z5bkqVJ/NDvLQjL13Lq5NWjGdAgMBAAGjggHNMIIByTAOBgNVHQ8B
          Af8EBAMCBeAwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB
          /wQCMAAwHQYDVR0OBBYEFBwgzWNGEsno7aQaC+dyP8e/VpFIMIIBaQYDVR0RBIIB
          YDCCAVyCCmt1YmVybmV0ZXOCEmt1YmVybmV0ZXMuZGVmYXVsdIIWa3ViZXJuZXRl
          cy5kZWZhdWx0LnN2Y4Ika3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxv
          Y2Fsgg5rdWJlLWFwaXNlcnZlcoIKa3ViZS1hZG1pboIJbG9jYWxob3N0ggtleGFt
          cGxlLmNvbYIHY29yZW9zMYIHY29yZW9zMoIHY29yZW9zM4INY29yZW9zMS5sb2Nh
          bIINY29yZW9zMi5sb2NhbIINY29yZW9zMy5sb2NhbIITY29yZW9zMS5leGFtcGxl
          LmNvbYITY29yZW9zMi5leGFtcGxlLmNvbYITY29yZW9zMy5leGFtcGxlLmNvbYcE
          fwAAAYcEAAAAAIcECgACC4cECgACDIcECgACDYcECgMAAYcECgACAYcECgACAoER
          YWRtaW5AZXhhbXBsZS5jb20wDQYJKoZIhvcNAQELBQADggEBAEuFSUFKJUK7MeAz
          1ISO/YgNoSzUsGVktc9zNLeEuzYKzA2k/3FahaPq53NDyW8BTYWQygCivytF9jsx
          ddQ8CFc6FzX5JulkJllKo7CjhwMxdjiNTSVCXatD1hb9PSCwyk0DhRjzPxJcQDxC
          pjyts0IGpEhdDGDRCmSakRn+AaPIa6Y1VtCs/apzY0b7IzAWp4qx7N3NQ1K+N694
          vfVDgz0Y8JOvVvpcUhOs4jd4S/gwKMTXwQT46ice3xi/A6EhVJTD1CBWoePZX5L+
          sWiZWgQ1DlesQu4wCaxhRuakCyJYA4YAwPcivt2n4KzfTuDfnU+8fykI+e4tGxCo
          f28gGmw=
          -----END CERTIFICATE-----

    - path: /etc/docker/server-key.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEpQIBAAKCAQEAvHYDcnjG8WeV1HsVs4+/aJdfnb8uHba2NGhBm7s0BsFH7DRn
          SC4QvmwFZrHs3ymsYTe//k/nZVJ5RPGlmaekr/ibnMr3Huz69SG/dzvr5OvNUrr4
          vR25Ew8vcY9BvIQ8fHxV3n0KaNRuUpEmhg/Rl5eIkFXNbPpJ0d73qlqlzTpGhNv+
          2XqxnIgd2KNVrslI1w9Kmw9Tdzae8BmSbBDCexUZk4ombSihdhyox6B8r5betrF0
          tjQNPxTg09WMCyKOoQFoS6tGkfcLHyDUsqS4Nk+Qd4Tf6RoEf2SgqZFoKLGrbw+e
          sCT9cZwGnBFe2eW5KlSfzQ7y0Iy9dy6uTVoxnQIDAQABAoIBAQCiVfV6MVcMsnF5
          adyzo2r5KQsP0pJivfQNCJEbGBIkj3DooeslXajGnj24zCKByF/YDjGvWhy0Rmp3
          XL+Mr79IZRmF4b8kQHWbmcpXZqI3unZOgQepv2SgakAvzXqObEm94UwGLic9TV8K
          eEV6zT15GupjicU9zgqwYSNs9lBDiiij1qp9v8UrlFwBcIESe7GRXy2xx+NGixdv
          wajizL0BXnLkx6Rw0Pq5Twcuew/5K+OcBqmHw09vRRGfZEgwqxcKkPiDkhmjSHqr
          t8+TLQfcP3nprPB79lQyhAU3feD6WaxWNNAbRfE4ibrtrJ81TUsc6IKbgd8sq3iA
          JUnQhlPxAoGBAN+yDN56v5FRe/y3GoO5CFdllBbBP1sBgPRH8VEX58BuCmhrUjjN
          oLkQmbdGYPABdvb5yNtKfztLK7yL25NLLJ3KVgADdvnweDJlwHFjm+fMA3Aubp5y
          DF7ju0oViniI+RejXDBoDYgkKip/IzTP1EQbyXl38KmX7Ir7m3JV0qkvAoGBANet
          WsU32SIqGXa0PipgIyGGl476dLmdPhn7pcIUVrhOHCQOEXeknyDRSYxjubTk2f4o
          kr0pjGjOQFCvIEQBaRvI8CQvRN+I6DohnKG7DR4U+RxhXM7Na3+6twjagJzDNSVY
          lWr62F4SrZz0ZBoasxzjynnrF4aqZtE4tJ6sO4bzAoGBALji+b38qE8ckSTb1f9f
          NKS/oTl5ebrnMEU3HR4QawziJpoNcgTe9+Nd9B7F/aMBIumYpEmTdjt0su6Ajfhc
          3sCAFrqmInUMKtxEu108ngRk28ahqe4th0n6YbcmvK9JTtAZxj2AEwceFPfQ4zFo
          QSIV8V0DJBeYKPrqYJ2Mj7QjAoGBAMmK63nEWJm+cZElmboLoIiht1sa3JzfPbsW
          F62nR+puw4lFxDjjkvgd2vbf8hgCi1sgGw+9lcISirNbE3G5R7l5Kj8GFPw2eZxo
          8G+J1hY4TxmgOhPejggMOSKC3RCgsjc18lrIEgzGs4oqLqjeLmZez0Ti1Vc4QWBd
          9xsXo4DVAoGAVGM++VmuuftagcEb373gOT0yO8+rbXdN9NT7HvIae9qPuVDfiiBj
          27hkSxhEEqeRojGWmxHhhvaZ5tcALtppAkpx+SKcihAVqcSaD2UH5O4LuyBRwxzi
          n+vQ5R0QKoy4dqlvqg4BeKwB9EjsflCN2p1OjLTXG+yeXHAmZLv0y8U=
          -----END RSA PRIVATE KEY-----

    - path: "/etc/motd"
      filesystem: root
      mode: 0644
      contents:
        inline: | 
          Just another day!!
    - path: /etc/environment
      filesystem: root
      mode: 0644
      contents:
        inline: |
          COREOS_VAGRANT_VIRTUALBOX_PRIVATE_IPV4=10.0.2.12
          COREOS_VAGRANT_VIRTUALBOX_HOSTNAME=coreos2
          ADVERTISE_IP=10.0.2.12
          COREOS_PRIVATE_IPV4=10.0.2.12
          ETCDCTL_SSL_DIR=/var/lib/etcd/ssl
          ETCD_SSL_DIR=/var/lib/etcd/ssl
          ETCDCTL_CA_FILE=/etc/ssl/certs/ca.pem
          ETCDCTL_CERT_FILE=/var/lib/etcd/ssl/etcd-node.pem
          ETCDCTL_KEY_FILE=/var/lib/etcd/ssl/etcd-node-key.pem
          ETCDCTL_ENDPOINTS="https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379"
          ETCD_ENDPOINTS="https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379"
          FLANNELD_ETCD_ENDPOINTS="https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379"
          FLANNELD_IFACE="enp0s3"
          FLANNELD_ETCD_PREFIX="/coreos.com/network"
          LOCKSMITHCTL_ETCD_CAFILE=/etc/ssl/certs/ca.pem
          LOCKSMITHCTL_ETCD_CERTFILE=/var/lib/etcd/ssl/etcd-node.pem
          LOCKSMITHCTL_ETCD_KEYFILE=/var/lib/etcd/ssl/etcd-node-key.pem
          LOCKSMITHCTL_ENDPOINT="https://10.0.2.12:2379"
          HTTP_PROXY=http://10.10.20.20:8080
          HTTPS_PROXY=http://10.10.20.20:8080
          http_proxy=http://10.10.20.20:8080
          https_proxy=http://10.10.20.20:8080
          no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,10.0.2.11,10.0.2.12,10.0.2.13,coreos1,coreos2,coreos3,coreos1.example.com,coreos2.example.com,coreos3.example.com,/var/run/docker.sock
    - path: /etc/systemd/system.conf.d/10-default-env.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Manager]
          DefaultEnvironment=http_proxy=http://10.10.20.20:8080
          DefaultEnvironment=https_proxy=http://10.10.20.20:8080
          DefaultEnvironment=HTTP_PROXY=http://10.10.20.20:8080
          DefaultEnvironment=HTTPS_PROXY=http://10.10.20.20:8080
          DefaultEnvironment="no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,10.0.2.11,10.0.2.12,10.0.2.13,coreos1,coreos2,coreos3,coreos1.example.com,coreos2.example.com,coreos3.example.com,/var/run/docker.sock"
    - path: /etc/systemd/system/docker.service.d/environment.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Service]
          EnvironmentFile=/etc/environment
    - path: /etc/systemd/timesyncd.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Time]
          NTP=pool.ntp.org
    - path: /var/lib/etcd/ssl/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDfzCCAmegAwIBAgIJAMccpPqk5dkHMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBdMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMQ0wCwYDVQQDDARFdGNkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
          CgKCAQEAsumylGcdl3DlAzCyqRz3+Sy/8H3mU+MfogEAr+ymNwq4c3eXpJbfhl7B
          a54Ji6drS69U4y4Zo3drE+5DjKE+OkMEgspYOo/IsPmCG2T3kH7AJPdgAIFxDiRh
          BDMrodfi9zN6VHTi7Cws2K/21VReYGJceekdoPLt+xxP9R06EWds53ner4pj1viT
          O5xRPZFXTy8iX9AHn5fqNq8nz/zkgmxtdRCbzrfZ+e5phwA7FXFEyMkoDq21ORK2
          TE07d+nIrmZg7oyHhmfXGCoptfRW2oyY+bzmLkZTiMeBr9WFZviCl0aDabQl789Y
          ojEPE460sjEugajGCbO8DJQFnLvZzQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAQYw
          DwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUJg+CfP5qQMBXSh7r4AUKgHrJSjww
          DQYJKoZIhvcNAQELBQADggEBADfNiixNNlpKYIlCAYmSvFXxUSEUXghhTp/WNDGI
          blahg+Mi0IOe7ZbvAJ3G0w10FchSUlB6DBTD0MH9iqUkuX97wLdJETsa5bH7g5XW
          ZDn+SkCwwBcH5UV7Fh7ebYwwWarB8hsXfpDmPbVDeGWrP9o6XXZPCvxSLUvSAcp2
          L0vRGyJGlSWSYBaxVQURRH+7Pl2VEt0udRZ2QVeXoOAagGEkJY4rwAYYVqMM3W7Q
          8nq/l/ai0hCpE4/m5zmcx1HwJbqE7Rg8DU5hwc6SHcZKLuaopsJPpdzKqz/BELKS
          NH8j4RkB7rBmQPm7Zoa98s0I/VfNU1Zd26gmXCSftkKKxLw=
          -----END CERTIFICATE-----

    - path: /etc/ssl/certs/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDfzCCAmegAwIBAgIJAMccpPqk5dkHMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBdMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMQ0wCwYDVQQDDARFdGNkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
          CgKCAQEAsumylGcdl3DlAzCyqRz3+Sy/8H3mU+MfogEAr+ymNwq4c3eXpJbfhl7B
          a54Ji6drS69U4y4Zo3drE+5DjKE+OkMEgspYOo/IsPmCG2T3kH7AJPdgAIFxDiRh
          BDMrodfi9zN6VHTi7Cws2K/21VReYGJceekdoPLt+xxP9R06EWds53ner4pj1viT
          O5xRPZFXTy8iX9AHn5fqNq8nz/zkgmxtdRCbzrfZ+e5phwA7FXFEyMkoDq21ORK2
          TE07d+nIrmZg7oyHhmfXGCoptfRW2oyY+bzmLkZTiMeBr9WFZviCl0aDabQl789Y
          ojEPE460sjEugajGCbO8DJQFnLvZzQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAQYw
          DwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUJg+CfP5qQMBXSh7r4AUKgHrJSjww
          DQYJKoZIhvcNAQELBQADggEBADfNiixNNlpKYIlCAYmSvFXxUSEUXghhTp/WNDGI
          blahg+Mi0IOe7ZbvAJ3G0w10FchSUlB6DBTD0MH9iqUkuX97wLdJETsa5bH7g5XW
          ZDn+SkCwwBcH5UV7Fh7ebYwwWarB8hsXfpDmPbVDeGWrP9o6XXZPCvxSLUvSAcp2
          L0vRGyJGlSWSYBaxVQURRH+7Pl2VEt0udRZ2QVeXoOAagGEkJY4rwAYYVqMM3W7Q
          8nq/l/ai0hCpE4/m5zmcx1HwJbqE7Rg8DU5hwc6SHcZKLuaopsJPpdzKqz/BELKS
          NH8j4RkB7rBmQPm7Zoa98s0I/VfNU1Zd26gmXCSftkKKxLw=
          -----END CERTIFICATE-----

    - path: /etc/kubernetes/ssl/ca.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIDfzCCAmegAwIBAgIJAMccpPqk5dkHMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBdMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMQ0wCwYDVQQDDARFdGNkMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
          CgKCAQEAsumylGcdl3DlAzCyqRz3+Sy/8H3mU+MfogEAr+ymNwq4c3eXpJbfhl7B
          a54Ji6drS69U4y4Zo3drE+5DjKE+OkMEgspYOo/IsPmCG2T3kH7AJPdgAIFxDiRh
          BDMrodfi9zN6VHTi7Cws2K/21VReYGJceekdoPLt+xxP9R06EWds53ner4pj1viT
          O5xRPZFXTy8iX9AHn5fqNq8nz/zkgmxtdRCbzrfZ+e5phwA7FXFEyMkoDq21ORK2
          TE07d+nIrmZg7oyHhmfXGCoptfRW2oyY+bzmLkZTiMeBr9WFZviCl0aDabQl789Y
          ojEPE460sjEugajGCbO8DJQFnLvZzQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAQYw
          DwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUJg+CfP5qQMBXSh7r4AUKgHrJSjww
          DQYJKoZIhvcNAQELBQADggEBADfNiixNNlpKYIlCAYmSvFXxUSEUXghhTp/WNDGI
          blahg+Mi0IOe7ZbvAJ3G0w10FchSUlB6DBTD0MH9iqUkuX97wLdJETsa5bH7g5XW
          ZDn+SkCwwBcH5UV7Fh7ebYwwWarB8hsXfpDmPbVDeGWrP9o6XXZPCvxSLUvSAcp2
          L0vRGyJGlSWSYBaxVQURRH+7Pl2VEt0udRZ2QVeXoOAagGEkJY4rwAYYVqMM3W7Q
          8nq/l/ai0hCpE4/m5zmcx1HwJbqE7Rg8DU5hwc6SHcZKLuaopsJPpdzKqz/BELKS
          NH8j4RkB7rBmQPm7Zoa98s0I/VfNU1Zd26gmXCSftkKKxLw=
          -----END CERTIFICATE-----

    - path: /etc/kubernetes/ssl/etcd-node.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIFETCCA/mgAwIBAgIJANiJBN6VG8sKMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBiMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMRIwEAYDVQQDDAlldGNkLW5vZGUwggEiMA0GCSqGSIb3DQEBAQUAA4IB
          DwAwggEKAoIBAQC8dgNyeMbxZ5XUexWzj79ol1+dvy4dtrY0aEGbuzQGwUfsNGdI
          LhC+bAVmsezfKaxhN7/+T+dlUnlE8aWZp6Sv+Jucyvce7Pr1Ib93O+vk681Suvi9
          HbkTDy9xj0G8hDx8fFXefQpo1G5SkSaGD9GXl4iQVc1s+knR3veqWqXNOkaE2/7Z
          erGciB3Yo1WuyUjXD0qbD1N3Np7wGZJsEMJ7FRmTiiZtKKF2HKjHoHyvlt62sXS2
          NA0/FODT1YwLIo6hAWhLq0aR9wsfINSypLg2T5B3hN/pGgR/ZKCpkWgosatvD56w
          JP1xnAacEV7Z5bkqVJ/NDvLQjL13Lq5NWjGdAgMBAAGjggHNMIIByTAOBgNVHQ8B
          Af8EBAMCBeAwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB
          /wQCMAAwHQYDVR0OBBYEFBwgzWNGEsno7aQaC+dyP8e/VpFIMIIBaQYDVR0RBIIB
          YDCCAVyCCmt1YmVybmV0ZXOCEmt1YmVybmV0ZXMuZGVmYXVsdIIWa3ViZXJuZXRl
          cy5kZWZhdWx0LnN2Y4Ika3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxv
          Y2Fsgg5rdWJlLWFwaXNlcnZlcoIKa3ViZS1hZG1pboIJbG9jYWxob3N0ggtleGFt
          cGxlLmNvbYIHY29yZW9zMYIHY29yZW9zMoIHY29yZW9zM4INY29yZW9zMS5sb2Nh
          bIINY29yZW9zMi5sb2NhbIINY29yZW9zMy5sb2NhbIITY29yZW9zMS5leGFtcGxl
          LmNvbYITY29yZW9zMi5leGFtcGxlLmNvbYITY29yZW9zMy5leGFtcGxlLmNvbYcE
          fwAAAYcEAAAAAIcECgACC4cECgACDIcECgACDYcECgMAAYcECgACAYcECgACAoER
          YWRtaW5AZXhhbXBsZS5jb20wDQYJKoZIhvcNAQELBQADggEBAEuFSUFKJUK7MeAz
          1ISO/YgNoSzUsGVktc9zNLeEuzYKzA2k/3FahaPq53NDyW8BTYWQygCivytF9jsx
          ddQ8CFc6FzX5JulkJllKo7CjhwMxdjiNTSVCXatD1hb9PSCwyk0DhRjzPxJcQDxC
          pjyts0IGpEhdDGDRCmSakRn+AaPIa6Y1VtCs/apzY0b7IzAWp4qx7N3NQ1K+N694
          vfVDgz0Y8JOvVvpcUhOs4jd4S/gwKMTXwQT46ice3xi/A6EhVJTD1CBWoePZX5L+
          sWiZWgQ1DlesQu4wCaxhRuakCyJYA4YAwPcivt2n4KzfTuDfnU+8fykI+e4tGxCo
          f28gGmw=
          -----END CERTIFICATE-----

    - path: /etc/kubernetes/ssl/etcd-node-key.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEpQIBAAKCAQEAvHYDcnjG8WeV1HsVs4+/aJdfnb8uHba2NGhBm7s0BsFH7DRn
          SC4QvmwFZrHs3ymsYTe//k/nZVJ5RPGlmaekr/ibnMr3Huz69SG/dzvr5OvNUrr4
          vR25Ew8vcY9BvIQ8fHxV3n0KaNRuUpEmhg/Rl5eIkFXNbPpJ0d73qlqlzTpGhNv+
          2XqxnIgd2KNVrslI1w9Kmw9Tdzae8BmSbBDCexUZk4ombSihdhyox6B8r5betrF0
          tjQNPxTg09WMCyKOoQFoS6tGkfcLHyDUsqS4Nk+Qd4Tf6RoEf2SgqZFoKLGrbw+e
          sCT9cZwGnBFe2eW5KlSfzQ7y0Iy9dy6uTVoxnQIDAQABAoIBAQCiVfV6MVcMsnF5
          adyzo2r5KQsP0pJivfQNCJEbGBIkj3DooeslXajGnj24zCKByF/YDjGvWhy0Rmp3
          XL+Mr79IZRmF4b8kQHWbmcpXZqI3unZOgQepv2SgakAvzXqObEm94UwGLic9TV8K
          eEV6zT15GupjicU9zgqwYSNs9lBDiiij1qp9v8UrlFwBcIESe7GRXy2xx+NGixdv
          wajizL0BXnLkx6Rw0Pq5Twcuew/5K+OcBqmHw09vRRGfZEgwqxcKkPiDkhmjSHqr
          t8+TLQfcP3nprPB79lQyhAU3feD6WaxWNNAbRfE4ibrtrJ81TUsc6IKbgd8sq3iA
          JUnQhlPxAoGBAN+yDN56v5FRe/y3GoO5CFdllBbBP1sBgPRH8VEX58BuCmhrUjjN
          oLkQmbdGYPABdvb5yNtKfztLK7yL25NLLJ3KVgADdvnweDJlwHFjm+fMA3Aubp5y
          DF7ju0oViniI+RejXDBoDYgkKip/IzTP1EQbyXl38KmX7Ir7m3JV0qkvAoGBANet
          WsU32SIqGXa0PipgIyGGl476dLmdPhn7pcIUVrhOHCQOEXeknyDRSYxjubTk2f4o
          kr0pjGjOQFCvIEQBaRvI8CQvRN+I6DohnKG7DR4U+RxhXM7Na3+6twjagJzDNSVY
          lWr62F4SrZz0ZBoasxzjynnrF4aqZtE4tJ6sO4bzAoGBALji+b38qE8ckSTb1f9f
          NKS/oTl5ebrnMEU3HR4QawziJpoNcgTe9+Nd9B7F/aMBIumYpEmTdjt0su6Ajfhc
          3sCAFrqmInUMKtxEu108ngRk28ahqe4th0n6YbcmvK9JTtAZxj2AEwceFPfQ4zFo
          QSIV8V0DJBeYKPrqYJ2Mj7QjAoGBAMmK63nEWJm+cZElmboLoIiht1sa3JzfPbsW
          F62nR+puw4lFxDjjkvgd2vbf8hgCi1sgGw+9lcISirNbE3G5R7l5Kj8GFPw2eZxo
          8G+J1hY4TxmgOhPejggMOSKC3RCgsjc18lrIEgzGs4oqLqjeLmZez0Ti1Vc4QWBd
          9xsXo4DVAoGAVGM++VmuuftagcEb373gOT0yO8+rbXdN9NT7HvIae9qPuVDfiiBj
          27hkSxhEEqeRojGWmxHhhvaZ5tcALtppAkpx+SKcihAVqcSaD2UH5O4LuyBRwxzi
          n+vQ5R0QKoy4dqlvqg4BeKwB9EjsflCN2p1OjLTXG+yeXHAmZLv0y8U=
          -----END RSA PRIVATE KEY-----

    - path: /var/lib/etcd/ssl/etcd-node.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN CERTIFICATE-----
          MIIFETCCA/mgAwIBAgIJANiJBN6VG8sKMA0GCSqGSIb3DQEBCwUAMF0xCzAJBgNV
          BAYTAlVTMQswCQYDVQQIDAJOWTERMA8GA1UEBwwITmV3IFlvcmsxETAPBgNVBAoM
          CENvbXBhbnkxMQwwCgYDVQQLDANPcHMxDTALBgNVBAMMBEV0Y2QwHhcNMTcxMjA0
          MjA0MzQ4WhcNMjcxMjAyMjA0MzQ4WjBiMQswCQYDVQQGEwJVUzELMAkGA1UECAwC
          TlkxETAPBgNVBAcMCE5ldyBZb3JrMREwDwYDVQQKDAhDb21wYW55MTEMMAoGA1UE
          CwwDT3BzMRIwEAYDVQQDDAlldGNkLW5vZGUwggEiMA0GCSqGSIb3DQEBAQUAA4IB
          DwAwggEKAoIBAQC8dgNyeMbxZ5XUexWzj79ol1+dvy4dtrY0aEGbuzQGwUfsNGdI
          LhC+bAVmsezfKaxhN7/+T+dlUnlE8aWZp6Sv+Jucyvce7Pr1Ib93O+vk681Suvi9
          HbkTDy9xj0G8hDx8fFXefQpo1G5SkSaGD9GXl4iQVc1s+knR3veqWqXNOkaE2/7Z
          erGciB3Yo1WuyUjXD0qbD1N3Np7wGZJsEMJ7FRmTiiZtKKF2HKjHoHyvlt62sXS2
          NA0/FODT1YwLIo6hAWhLq0aR9wsfINSypLg2T5B3hN/pGgR/ZKCpkWgosatvD56w
          JP1xnAacEV7Z5bkqVJ/NDvLQjL13Lq5NWjGdAgMBAAGjggHNMIIByTAOBgNVHQ8B
          Af8EBAMCBeAwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMAwGA1UdEwEB
          /wQCMAAwHQYDVR0OBBYEFBwgzWNGEsno7aQaC+dyP8e/VpFIMIIBaQYDVR0RBIIB
          YDCCAVyCCmt1YmVybmV0ZXOCEmt1YmVybmV0ZXMuZGVmYXVsdIIWa3ViZXJuZXRl
          cy5kZWZhdWx0LnN2Y4Ika3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxv
          Y2Fsgg5rdWJlLWFwaXNlcnZlcoIKa3ViZS1hZG1pboIJbG9jYWxob3N0ggtleGFt
          cGxlLmNvbYIHY29yZW9zMYIHY29yZW9zMoIHY29yZW9zM4INY29yZW9zMS5sb2Nh
          bIINY29yZW9zMi5sb2NhbIINY29yZW9zMy5sb2NhbIITY29yZW9zMS5leGFtcGxl
          LmNvbYITY29yZW9zMi5leGFtcGxlLmNvbYITY29yZW9zMy5leGFtcGxlLmNvbYcE
          fwAAAYcEAAAAAIcECgACC4cECgACDIcECgACDYcECgMAAYcECgACAYcECgACAoER
          YWRtaW5AZXhhbXBsZS5jb20wDQYJKoZIhvcNAQELBQADggEBAEuFSUFKJUK7MeAz
          1ISO/YgNoSzUsGVktc9zNLeEuzYKzA2k/3FahaPq53NDyW8BTYWQygCivytF9jsx
          ddQ8CFc6FzX5JulkJllKo7CjhwMxdjiNTSVCXatD1hb9PSCwyk0DhRjzPxJcQDxC
          pjyts0IGpEhdDGDRCmSakRn+AaPIa6Y1VtCs/apzY0b7IzAWp4qx7N3NQ1K+N694
          vfVDgz0Y8JOvVvpcUhOs4jd4S/gwKMTXwQT46ice3xi/A6EhVJTD1CBWoePZX5L+
          sWiZWgQ1DlesQu4wCaxhRuakCyJYA4YAwPcivt2n4KzfTuDfnU+8fykI+e4tGxCo
          f28gGmw=
          -----END CERTIFICATE-----

    - path: /var/lib/etcd/ssl/etcd-node-key.pem
      filesystem: root
      mode: 0644
      contents:
        inline: |
          -----BEGIN RSA PRIVATE KEY-----
          MIIEpQIBAAKCAQEAvHYDcnjG8WeV1HsVs4+/aJdfnb8uHba2NGhBm7s0BsFH7DRn
          SC4QvmwFZrHs3ymsYTe//k/nZVJ5RPGlmaekr/ibnMr3Huz69SG/dzvr5OvNUrr4
          vR25Ew8vcY9BvIQ8fHxV3n0KaNRuUpEmhg/Rl5eIkFXNbPpJ0d73qlqlzTpGhNv+
          2XqxnIgd2KNVrslI1w9Kmw9Tdzae8BmSbBDCexUZk4ombSihdhyox6B8r5betrF0
          tjQNPxTg09WMCyKOoQFoS6tGkfcLHyDUsqS4Nk+Qd4Tf6RoEf2SgqZFoKLGrbw+e
          sCT9cZwGnBFe2eW5KlSfzQ7y0Iy9dy6uTVoxnQIDAQABAoIBAQCiVfV6MVcMsnF5
          adyzo2r5KQsP0pJivfQNCJEbGBIkj3DooeslXajGnj24zCKByF/YDjGvWhy0Rmp3
          XL+Mr79IZRmF4b8kQHWbmcpXZqI3unZOgQepv2SgakAvzXqObEm94UwGLic9TV8K
          eEV6zT15GupjicU9zgqwYSNs9lBDiiij1qp9v8UrlFwBcIESe7GRXy2xx+NGixdv
          wajizL0BXnLkx6Rw0Pq5Twcuew/5K+OcBqmHw09vRRGfZEgwqxcKkPiDkhmjSHqr
          t8+TLQfcP3nprPB79lQyhAU3feD6WaxWNNAbRfE4ibrtrJ81TUsc6IKbgd8sq3iA
          JUnQhlPxAoGBAN+yDN56v5FRe/y3GoO5CFdllBbBP1sBgPRH8VEX58BuCmhrUjjN
          oLkQmbdGYPABdvb5yNtKfztLK7yL25NLLJ3KVgADdvnweDJlwHFjm+fMA3Aubp5y
          DF7ju0oViniI+RejXDBoDYgkKip/IzTP1EQbyXl38KmX7Ir7m3JV0qkvAoGBANet
          WsU32SIqGXa0PipgIyGGl476dLmdPhn7pcIUVrhOHCQOEXeknyDRSYxjubTk2f4o
          kr0pjGjOQFCvIEQBaRvI8CQvRN+I6DohnKG7DR4U+RxhXM7Na3+6twjagJzDNSVY
          lWr62F4SrZz0ZBoasxzjynnrF4aqZtE4tJ6sO4bzAoGBALji+b38qE8ckSTb1f9f
          NKS/oTl5ebrnMEU3HR4QawziJpoNcgTe9+Nd9B7F/aMBIumYpEmTdjt0su6Ajfhc
          3sCAFrqmInUMKtxEu108ngRk28ahqe4th0n6YbcmvK9JTtAZxj2AEwceFPfQ4zFo
          QSIV8V0DJBeYKPrqYJ2Mj7QjAoGBAMmK63nEWJm+cZElmboLoIiht1sa3JzfPbsW
          F62nR+puw4lFxDjjkvgd2vbf8hgCi1sgGw+9lcISirNbE3G5R7l5Kj8GFPw2eZxo
          8G+J1hY4TxmgOhPejggMOSKC3RCgsjc18lrIEgzGs4oqLqjeLmZez0Ti1Vc4QWBd
          9xsXo4DVAoGAVGM++VmuuftagcEb373gOT0yO8+rbXdN9NT7HvIae9qPuVDfiiBj
          27hkSxhEEqeRojGWmxHhhvaZ5tcALtppAkpx+SKcihAVqcSaD2UH5O4LuyBRwxzi
          n+vQ5R0QKoy4dqlvqg4BeKwB9EjsflCN2p1OjLTXG+yeXHAmZLv0y8U=
          -----END RSA PRIVATE KEY-----

    - path: /etc/profile.d/aliases.sh
      filesystem: root
      mode: 0755
      contents:
        inline: |
          dps () { docker ps -a ; }
          dl () { docker logs -f $1 & }
          drm () { docker stop $1 && docker rm $1; }
          PATH=$PATH:/opt/bin
    - path: /etc/flannel/options.env
      filesystem: root
      mode: 0644
      contents:
        inline: |
          # ETCDCTL parameters
          ADVERTISE_IP=${ADVERTISE_IP}
          ETCDCTL_CA_FILE=/etc/ssl/certs/ca.pem
          ETCDCTL_CERT_FILE=/var/lib/etcd/ssl/etcd-node.pem
          ETCDCTL_KEY_FILE=/var/lib/etcd/ssl/etcd-node-key.pem
          ETCDCTL_ENDPOINTS="https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379"
          FLANNELD_IFACE="enp0s3"
          FLANNELD_ETCD_ENDPOINTS=${ETCDCTL_ENDPOINTS}
          FLANNELD_ETCD_PREFIX="/coreos.com/network"
    - path: /etc/systemd/system/docker.service.d/40-flannel.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Unit]
          Requires=flanneld.service
          After=flanneld.service
          [Service]
          EnvironmentFile=/etc/kubernetes/cni/docker_opts_cni.env
    - path: /etc/kubernetes/cni/docker_opts_cni.env
      filesystem: root
      mode: 0644
      contents:
        inline: |
          DOCKER_OPT_BIP=""
          DOCKER_OPT_IPMASQ=""
    - path: /etc/kubernetes/cni/net.d/10-containernet.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          {
              "name": "podnet",
              "type": "flannel",
              "delegate": {
                  "forceAddress": true,
                  "isDefaultGateway": true,
                  "hairpinMode": true
              }
          }
    - path: /etc/systemd/system/flanneld.service.d/40-ExecStartPre-symlink.conf
      filesystem: root
      mode: 0644
      contents:
        inline: |
          [Service]
          ExecStartPre=/usr/bin/ln -sf /etc/flannel/options.env /run/flannel/options.env
          ExecStartPre=/usr/bin/ln -sf /etc/kubernetes/cni/net.d /etc/rkt/net.d
    - path: /etc/kubernetes/kubelet.env
      filesystem: root
      mode: 0644
      contents:
        inline: |
          KUBELET_IMAGE_URL=quay.io/coreos/hyperkube
          KUBELET_VERSION=v1.8.0_coreos.0
    - path: /etc/kubernetes/kubeconfig.yaml 
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Config
          clusters:
          - name: local
            cluster:
              server: https://10.0.2.12:443
              certificate-authority: /etc/kubernetes/ssl/ca.pem
          users:
          - name: kubelet
            user:
              client-certificate: /etc/kubernetes/ssl/etcd-node.pem
              client-key: /etc/kubernetes/ssl/etcd-node-key.pem
          contexts:
          - context:
              cluster: local
              user: kubelet
    - path: /etc/kubernetes/manifests/kube-apiserver.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-apiserver
            namespace: kube-system
          spec:
            hostNetwork: true
            containers:
            - name: kube-apiserver
              image: quay.io/coreos/hyperkube:v1.8.0_coreos.0
              command:
              - /hyperkube
              - apiserver
              - --bind-address=0.0.0.0
              - --etcd-servers=https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379
              - --allow-privileged=true
              - --service-cluster-ip-range=10.3.0.0/21
              - --secure-port=443
              - --insecure-port=8080
              - --advertise-address=10.0.2.12
              - --storage-backend=etcd3
              - --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota
              - --etcd-certfile=/var/lib/etcd/ssl/etcd-node.pem
              - --etcd-keyfile=/var/lib/etcd/ssl/etcd-node-key.pem
              - --tls-cert-file=/var/lib/etcd/ssl/etcd-node.pem
              - --tls-private-key-file=/var/lib/etcd/ssl/etcd-node-key.pem
              - --kubelet-client-certificate=/var/lib/etcd/ssl/etcd-node.pem
              - --kubelet-client-key=/var/lib/etcd/ssl/etcd-node-key.pem
              - --service-account-key-file=/var/lib/etcd/ssl/etcd-node-key.pem
              - --etcd-cafile=/var/lib/etcd/ssl/ca.pem
              - --tls-ca-file=/var/lib/etcd/ssl/ca.pem
              - --client-ca-file=/var/lib/etcd/ssl/ca.pem
              - --runtime-config=extensions/v1beta1/networkpolicies=true,extensions/v1beta1=true
              - --anonymous-auth=false
              - --audit-log-path=/var/log/kubernetes/kube-apiserver-audit.log
              - --audit-log-maxage=30
              - --audit-log-maxbackup=3
              - --audit-log-maxsize=100
              - --v=3
              livenessProbe:
                httpGet:
                  host: 127.0.0.1
                  port: 8080
                  path: /healthz
                initialDelaySeconds: 15
                timeoutSeconds: 15
              ports:
              - containerPort: 443
                hostPort: 443
                name: https
              - containerPort: 8080
                hostPort: 8080
                name: local
              volumeMounts:
              - mountPath: /var/lib/etcd/ssl
                name: ssl-certs-kubernetes
                readOnly: true
              - mountPath: /etc/ssl/certs
                name: ssl-certs-host
                readOnly: true
              - mountPath: /var/log/kubernetes
                name: var-log-kubernetes
                readOnly: false
            volumes:
            - hostPath:
                path: /var/lib/etcd/ssl
              name: ssl-certs-kubernetes
            - hostPath:
                path: /usr/share/ca-certificates
              name: ssl-certs-host
            - hostPath:
                path: /var/log/kubernetes
              name: var-log-kubernetes

    - path: /etc/kubernetes/manifests/kube-controller-manager.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-controller-manager
            namespace: kube-system
          spec:
                hostNetwork: true
                containers:
                - name: kube-controller-manager
                  image: quay.io/coreos/hyperkube:v1.8.0_coreos.0
                  command:
                  - ./hyperkube
                  - controller-manager
                  - --master=http://127.0.0.1:8080
                  - --leader-elect=true
                  - --allocate-node-cidrs=true
                  - --cluster-cidr=10.0.0.0/20
                  - --service-account-private-key-file=/var/lib/etcd/ssl/etcd-node-key.pem
                  - --root-ca-file=/var/lib/etcd/ssl/ca.pem
                  livenessProbe:
                    httpGet:
                      host: 127.0.0.1
                      path: /healthz
                      port: 10252  # Note: Using default port. Update if --port option is set differently.
                    initialDelaySeconds: 15
                    timeoutSeconds: 5
                  volumeMounts:
                  - mountPath: /var/lib/etcd/ssl
                    name: secrets
                    readOnly: true
                  - mountPath: /etc/ssl/certs
                    name: ssl-host
                    readOnly: true
                  - mountPath: /var/log/kube-controller-manager.log
                    name: logfile
                    readOnly: false
                volumes:
                - hostPath:
                    path: /var/lib/etcd/ssl
                  name: secrets
                - hostPath:
                    path: /usr/share/ca-certificates
                  name: ssl-host
                - hostPath:
                    path: /var/log/kube-controller-manager.log
                  name: logfile

    - path: /etc/kubernetes/manifests/kube-proxy.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-proxy
            namespace: kube-system
            labels:
              tier: node
              k8s-app: kube-proxy
          spec:
                hostNetwork: true
                containers:
                - name: kube-proxy
                  image: quay.io/coreos/hyperkube:v1.8.0_coreos.0
                  command:
                  - ./hyperkube
                  - proxy
                  - --master=http://127.0.0.1:8080
                  - --logtostderr=true
                  - --proxy-mode=iptables
                  - --hostname-override=10.0.2.12
                  - --cluster-cidr=10.0.0.0/20
                  - --v=3
                  env:
                    - name: NODE_NAME
                      valueFrom:
                        fieldRef:
                          fieldPath: spec.nodeName
                  securityContext:
                    privileged: true
                  volumeMounts:
                  - mountPath: /etc/ssl/certs
                    name: ssl-certs-host
                    readOnly: true
                  - name: etc-kubernetes
                    mountPath: /var/lib/etcd/ssl
                    readOnly: true
                tolerations:
                - key: "node-role.kubernetes.io/master"
                  operator: "Exists"
                  effect: "NoSchedule"
                volumes:
                - hostPath:
                    path: /usr/share/ca-certificates
                  name: ssl-certs-host
                - name: etc-kubernetes
                  hostPath:
                    path: /etc/kubernetes

    - path: /etc/kubernetes/manifests/kube-scheduler.yaml
      filesystem: root
      mode: 0644
      contents:
        inline: |
          apiVersion: v1
          kind: Pod
          metadata:
            name: kube-scheduler
            namespace: kube-system
          spec:
            hostNetwork: true
            containers:
            - name: kube-scheduler
              image: quay.io/coreos/hyperkube:v1.8.0_coreos.0
              command:
              - ./hyperkube
              - scheduler
              - --master=http://127.0.0.1:8080
              - --address=0.0.0.0
              - --leader-elect=true
              - --v=3
              livenessProbe:
                  httpGet:
                    host: 127.0.0.1
                    path: /healthz
                    port: 10251  # Note: Using default port. Update if --port option is set differently.
                  initialDelaySeconds: 15
                  timeoutSeconds: 15
              nodeSelector:
                node-role.kubernetes.io/master: ""
              securityContext:
                runAsNonRoot: true
                runAsUser: 65534
              volumeMounts:
              - mountPath: /var/log/kube-scheduler.log
                name: logfile
            volumes:
            - hostPath:
                path: /var/log/kube-scheduler.log
              name: logfile


passwd:
  users:
    - name: usera
      password_hash: "$6$c53853acb0aa4d28$otVNrTdXlMCOZ/tQrrctPkgK.ozDC/rfpchuJv.d2uJV2qwDOY40KH1RMUY4RADBq465gxni3chDM9ur8dDqQ/"
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC34ne5eetDxgFGToA/+HC9Q7EUGIqULGHOf8kO/XBXu8YtG2Uop0S54tgCAtcjhwF/ACaqHYBc+W+vPqlnH1Cet4gMuyVZn97o9hMBpM5A3o2euPdNPKWp2yy0qnF9U0N/6A7BsIYMgzwqb9jvku64+cgzu/eZWcEpfG1XqSOjuXA38k2ZM2+t5lY534MkMGNO6CKNv0oCj/m+m5+EB0DRp/dTpYYGEQXgiSUrwft0ItJ4pwefTo+TdPPRKCg9CWfe2+FGnP9qiBsGIM5z1uov8VmsQUZnfBVDtccumCCj5vLboX6y+n6ax0SLv/GZzzbOvAn+A2CHSzY1pRfpSLnr"
      home_dir: /home/usera
      groups:
        - sudo
        - docker
      shell: /bin/bash

systemd:
  units:
    - name: etcd-member.service
      dropins:
        - name: conf1.conf
          contents: |
            [Service]
            EnvironmentFile=/etc/environment

    - name: docker-tcp.socket
      enabled: false
      contents: |
        [Unit]
        Description=Docker Socket for the API

        [Socket]
        ListenStream=2375
        BindIPv6Only=both
        Service=docker.service

        [Install]
        WantedBy=sockets.target

    - name: docker.service
      enabled: false
      dropins:
        - name: 50-insecure-registry.conf
          contents: |
            [Service]
            Environment=DOCKER_OPTS=''
            Environment=HTTP_PROXY=http://10.10.20.20:8080
            Environment=HTTPS_PROXY=http://10.10.20.20:8080
            Environment=http_proxy=http://10.10.20.20:8080
            Environment=https_proxy=http://10.10.20.20:8080
            Environment=no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,10.0.2.11,10.0.2.12,10.0.2.13,coreos1,coreos2,coreos3,coreos1.example.com,coreos2.example.com,coreos3.example.com,/var/run/docker.sock

    - name: etcd-member.service
      enable: true

    - name: flanneld.service
      dropins:
        - name: 50-network-config.conf
          contents: |
            [Service]
            EnvironmentFile=/etc/flannel/options.env
            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{ "Network": "10.0.0.0/20", "SubnetLen": 24, "Backend": { "Type": "vxlan", "VNI": 1 } }'
            # VXlan/VNI/VLan example
            #ExecStartPre=/usr/bin/etcdctl ${CA} ${CERT} ${KEY} ${EP} set /coreos.com/network/red-db/config '{ "Network": "10.220.0.0/16", "SubnetLen": 24, "SubnetMin": "10.220.110.0", "SubnetMax": "10.220.200.0", "Backend": { "Type": "vxlan", "VNI": 6 } }'
            #ExecStartPre=/usr/bin/etcdctl ${CA} ${CERT} ${KEY} ${EP} set /coreos.com/network/red-app/config '{ "Network": "10.220.0.0/16", "SubnetLen": 24, "SubnetMin": "10.220.110.0", "SubnetMax": "10.220.200.0", "Backend": { "Type": "vxlan", "VNI": 5 } }'
            # This is needed for rkt to start due to some bug
            ExecStartPre=/usr/bin/rkt trust --skip-fingerprint-review --prefix=coreos.com/rkt/stage1-coreos
            ExecStartPre=/usr/bin/rkt image fetch coreos.com/rkt/stage1-coreos:1.29.0
            Restart=always

    - name: flanneld.service
      dropins:
        - name: 50-ssl.conf
          contents: |
            [Service]
            Environment="ETCD_SSL_DIR=/var/lib/etcd/ssl"

    - name: etcd-member-config.service
      enabled: true
      contents: |
        [Unit]
        Before=network-pre.target
        Wants=network-pre.target

        [Service]
        Type=oneshot
        ExecStart=/usr/bin/ln -sf /etc/metadata/coreos /run/metadata/coreos
        TimeoutSec=0
        RemainAfterExit=yes

        [Install]
        WantedBy=network.target

    - name: rkt-api-tcp.socket
      enabled: true
      contents: |
        [Unit]
        Description=rkt api service socket
        PartOf=rkt-api.service

        [Socket]
        ListenStream=127.0.0.1:15441
        Service=rkt-api.service
        BindIPv6Only=both

        [Install]
        WantedBy=sockets.target

    - name: rkt-api.service
      enabled: true
      contents: |
        [Unit]
        Description=rkt api service
        Documentation=http://github.com/rkt/rkt
        After=network.target rkt-api-tcp.socket
        Requires=rkt-api-tcp.socket

        [Service]
        ExecStart=/usr/bin/rkt api-service --local-config=/etc/rkt

        [Install]
        WantedBy=multi-user.target

    - name: rkt-gc.service
      enabled: true
      contents: |
        [Unit]
        Description=Garbage Collection for rkt

        [Service]
        Environment=GRACE_PERIOD=24h
        Type=oneshot
        ExecStart=/usr/bin/rkt gc --grace-period=${GRACE_PERIOD}

    - name: rkt-gc.timer
      enabled: true
      contents: |
        [Unit]
        Description=Periodic Garbage Collection for rkt

        [Timer]
        OnActiveSec=0s
        OnUnitActiveSec=12h

        [Install]
        WantedBy=multi-user.target

    - name: rkt-metadata.service
      enabled: true
      contents: |
        [Unit]
        Description=rkt metadata service
        Documentation=http://github.com/rkt/rkt
        After=network.target rkt-metadata.socket
        Requires=rkt-metadata.socket

        [Service]
        ExecStart=/usr/bin/rkt metadata-service

        [Install]
        WantedBy=multi-user.target

    - name: rkt-metadata.socket
      enabled: true
      contents: |
        [Unit]
        Description=rkt metadata service socket
        PartOf=rkt-metadata.service

        [Socket]
        ListenStream=/run/rkt/metadata-svc.sock
        SocketMode=0660
        SocketUser=root
        SocketGroup=root
        RemoveOnStop=true

        [Install]
        WantedBy=sockets.target

    - name: kubelet.service
      enabled: false
      contents: |
        [Unit]
        Description=The primary agent to run pods
        Documentation=http://kubernetes.io/docs/admin/kubelet/
        Requires=etcd-member.service
        After=flanneld.service
        
        [Service]
        Slice=system.slice
        Environment=KUBELET_IMAGE_TAG=v1.8.0_coreos.0
        #Environment=HTTP_PROXY=http://10.10.20.20:8080
        #Environment=HTTPS_PROXY=http://10.10.20.20:8080
        #Environment=http_proxy=http://10.10.20.20:8080
        #Environment=https_proxy=http://10.10.20.20:8080
        #Environment=no_proxy=localhost,127.0.0.0/8,127.0.0.1,::1,10.0.2.11,10.0.2.12,10.0.2.13,coreos1,coreos2,coreos3,coreos1.example.com,coreos2.example.com,coreos3.example.com,/var/run/docker.sock
        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests
        ExecStartPre=/usr/bin/mkdir -p /var/log/containers
        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/cni/net.d
        ExecStartPre=/usr/bin/mkdir -p /opt/cni/bin
        ExecStartPre=/usr/bin/mkdir -p /var/lib/cni
        Environment="RKT_RUN_ARGS=--uuid-file-save=/var/run/kubelet-pod.uuid \
          --net=host \
          --dns=host \
          --set-env-file=/etc/environment \
          --volume var-lib-rkt,kind=host,source=/var/lib/rkt \
          --mount volume=var-lib-rkt,target=/var/lib/rkt \
          --volume dns,kind=host,source=/etc/resolv.conf \
          --mount volume=dns,target=/etc/resolv.con \
          --volume var-lib-cni,kind=host,source=/var/lib/cni \
          --mount volume=var-lib-cni,target=/var/lib/cni \
          --volume var-log,kind=host,source=/var/log \
          --mount volume=var-log,target=/var/log \
          --volume container,kind=host,source=/var/log/containers \
          --mount volume=container,target=/var/log/containers \
          --volume rkt,kind=host,source=/usr/bin/rkt \
          --mount volume=rkt,target=/usr/bin/rkt"
        ExecStart=/usr/lib/coreos/kubelet-wrapper \
          --address="0.0.0.0" \
          --register-node=true \
          --container-runtime=rkt \
          --pod-manifest-path=/etc/kubernetes/manifests \
          --allow-privileged=true \
          --cert-dir=/etc/kubernetes/ssl \
          --tls-cert-file=/etc/kubernetes/ssl/etcd-node.pem \
          --tls-private-key-file=/etc/kubernetes/ssl/etcd-node-key.pem \
          --client-ca-file=/etc/kubernetes/ssl/ca.pem \
          --kubeconfig=/etc/kubernetes/kubeconfig.yaml \
          --cluster-dns=10.3.0.10 \
          --cluster-domain=cluster.local \
          --network-plugin=cni \
          --cni-conf-dir=/etc/kubernetes/cni/net.d \
          --lock-file=/var/run/lock/kubelet.lock \
          --exit-on-lock-contention \
          --cloud-provider="" \
          --cadvisor-port=4194 \
          --cgroups-per-qos=true \
          --cgroup-root=/ \
          --hostname-override=coreos2
        ExecStop=-/usr/bin/rkt stop --uuid-file=/var/run/kubelet-pod.uuid
        Restart=always
        RestartSec=10
        
        [Install]
        WantedBy=multi-user.target

    - name: settimezone.service
      enabled: true
      contents: |
        [Unit]
        Description=Set the time zone

        [Service]
        ExecStart=/usr/bin/timedatectl set-timezone America/New_York
        RemainAfterExit=yes
        Type=oneshot

networkd:
  units:
    - name: 00-eno0.network
      contents: |
        [Match]
        Name=enp0s3

        [Network]
        Address=10.0.2.12/24
        Gateway=10.0.2.2
        DNS=8.8.8.8
        DNS=8.8.4.4
        Domains=example.com

flannel:
  version:        0.9.0
  etcd_prefix:    "/coreos.com/network"
  etcd_endpoints: "https://10.0.2.11:2379,https://10.0.2.12:2379,https://10.0.2.13:2379"
  etcd_cafile:    /etc/ssl/certs/ca.pem
  etcd_certfile:  /var/lib/etcd/ssl/etcd-node.pem
  etcd_keyfile:   /var/lib/etcd/ssl/etcd-node-key.pem
  interface:      enp0s3

etcd:
  version:                     3.2.9
  name:                        coreos2
  data_dir:                    /var/lib/etcd
  listen_client_urls:          https://10.0.2.12:2379,https://127.0.0.1:2379,https://127.0.0.1:4001
  advertise_client_urls:       https://10.0.2.12:2379
  listen_peer_urls:            https://10.0.2.12:2380
  initial_advertise_peer_urls: https://10.0.2.12:2380
  initial_cluster:             coreos1=https://10.0.2.11:2380,coreos2=https://10.0.2.12:2380,coreos3=https://10.0.2.13:2380
  initial_cluster_token:       etcd-token
  initial_cluster_state:       new
  cert_file:                   /var/lib/etcd/ssl/etcd-node.pem
  key_file:                    /var/lib/etcd/ssl/etcd-node-key.pem
  peer_cert_file:              /var/lib/etcd/ssl/etcd-node.pem
  peer_key_file:               /var/lib/etcd/ssl/etcd-node-key.pem
  client_cert_auth:            true
  peer_client_cert_auth:       true
  trusted_ca_file:             /etc/ssl/certs/ca.pem
  peer_trusted_ca_file:        /etc/ssl/certs/ca.pem
  auto_compaction_retention:   1


update:
  group:  "alpha"
locksmith:
  reboot_strategy: "etcd-lock"
  etcd_endpoints:  "https://10.0.2.12:2379"
  etcd_cafile: /etc/ssl/certs/ca.pem
  etcd_certfile: /var/lib/etcd/ssl/etcd-node.pem
  etcd_keyfile: /var/lib/etcd/ssl/etcd-node-key.pem
